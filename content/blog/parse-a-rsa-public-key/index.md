---
title: "è§£æRSAå…¬é’¥"
date: "2023-08-01"
category: "dev"
emoji: "ğŸ”"
---

## èƒŒæ™¯

åœ¨ä¸€ä¸ªç§»åŠ¨ç«¯åº”ç”¨ä¸­éœ€è¦ç”¨åˆ° RSA å…¬é’¥è§£å¯†ï¼Œå¯¹åº”çš„æ˜¯ç§é’¥åŠ å¯†çš„å†…å®¹ï¼Œ~~è¿™è™½ç„¶ä¸æ˜¯å¸¸è§„ç”¨æ³•~~(ç­¾åä¹Ÿæ˜¯ç”¨çš„RSAç§é’¥åŠ å¯†å…¬é’¥è§£å¯†)ï¼Œå› ä¸ºå…¬ç§é’¥åŠ è§£å¯†çš„æ•°å­¦åŸç†æ˜¯å¯¹ç­‰çš„ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯å¯ä»¥è¿™æ ·ç”¨çš„ã€‚
ä½†ç”±äºä¸æ˜¯å¸¸è§„ç”¨æ³•ï¼Œåœ¨ Swift ä¸­æ²¡æœ‰æä¾›ç›¸åº”çš„ SDK æ¥ç›´æ¥ç”¨ï¼Œéœ€è¦æ‰‹æ’¸è§£å¯†ç®—æ³•ã€‚åœ¨æ’¸è§£å¯†çš„è¿‡ç¨‹ä¸­å¯¹å…¬é’¥æå–æ¨¡æ•°å’ŒæŒ‡æ•°ä¸€ç›´æœ‰é—®é¢˜ï¼Œæ‰€ä»¥èŠ±æ—¶é—´ç ”ç©¶äº†ä¸€ä¸‹å…¬é’¥çš„ä¸€äº›çŸ¥è¯†ã€‚

## å‚¨å¤‡çŸ¥è¯†

éœ€è¦æœ‰åŸºç¡€çš„è®¡ç®—æœºåŸºç¡€ï¼Œæ¯”å¦‚è¿›åˆ¶è½¬æ¢, base64, ASCII, äºŒè¿›åˆ¶ç­‰ã€‚

åœ¨è®¡ç®—æœºä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯äºŒè¿›åˆ¶å­˜å‚¨çš„ï¼Œ0101 è¿™ç§å½¢å¼ï¼Œä½†æˆ‘ä»¬å¹³æ—¶çœ‹åˆ°çš„æ•°å­—éƒ½æ˜¯åè¿›åˆ¶çš„ï¼Œæ¯”å¦‚ 13ã€‚è®¡ç®—æœºä¸­ä¸€ä¸ªå­—èŠ‚æ˜¯ 8 ä¸ªæ¯”ç‰¹ä½ï¼Œä¹Ÿå°±æ˜¯ `0101 0010` æ˜¯ä¸€ä¸ªå­—èŠ‚ã€‚ä¸€ä¸ªå­—èŠ‚å†…ï¼Œåœ¨åè¿›åˆ¶ä¸­ï¼Œæœ€å°æ˜¯ 0 ä¹Ÿå°±æ˜¯ `0000 0000`, æœ€å¤§æ˜¯ 255 ä¹Ÿå°±æ˜¯ `1111 1111`.
å¦ä¸€ä¸ªå¾ˆå¸¸è§çš„æ˜¯åå…­è¿›åˆ¶ï¼Œä¸¤ä½çš„åå…­è¿›åˆ¶å°±å¯ä»¥è¡¨ç¤ºä¸€ä¸ªå­—èŠ‚ã€‚
æ¯”å¦‚åå…­è¿›åˆ¶çš„ `0x12` å®ƒä»£è¡¨çš„äºŒè¿›åˆ¶æ˜¯ `0001 0010`. ä¸ºä»€ä¹ˆåå…­è¿›åˆ¶ä¼šå¸¸è§å‘¢ï¼Ÿå› ä¸ºåå…­è¿›åˆ¶çš„æ¯ä¸€ä½å–å€¼æ˜¯ `0~f`, åˆšå¥½è¡¨ç¤ºäºŒè¿›åˆ¶çš„ `0000~1111`.
å¯¹äºè®¡ç®—è€Œè¨€ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒè½»æ¾çš„ï¼ŒäºŒè¿›åˆ¶çš„ 4 ä½è®¡ç®—ä¸€ä¸ªï¼Œå°±æ˜¯åå…­è¿›åˆ¶çš„ä¸€ä½ã€‚ä½†æ˜¯è¦æ˜¯è½¬æ¢æˆåè¿›åˆ¶åˆ™éœ€è¦éº»çƒ¦çš„è®¡ç®—ï¼Œæ¯”å¦‚äºŒè¿›åˆ¶ `0110 1110` è½¬æ¢æˆåå…­è¿›åˆ¶æ˜¯ `0x6e`, è½¬æ¢æˆåè¿›åˆ¶æ˜¯ `2^6+2^5+2^3+2^2+2^1 = 110`.

åå…­è¿›åˆ¶è½¬æ¢åè¿›åˆ¶çš„è®¡ç®—è¿‡ç¨‹ï¼Œæ¯”å¦‚åå…­è¿›åˆ¶çš„ 123 è½¬æ¢æˆåè¿›åˆ¶ï¼š`1 * 16^2 + 2 * 16^1 + 3 = 291`.

Swift ä¸­ `Data` æ•°æ®å’Œ `[UInt8]` çš„ç›´æ¥è½¬æ¢:

```
let a: [UInt8] = [255, 0, 3, 8]
let data = Data(a)

let b = "abc".data(using: .utf8)
let c = [UInt8](b)
```

ä»»ä½•å­—ç¬¦ä¸²éƒ½å¯ä»¥é€šè¿‡ base64 ç¼–ç æˆåªç”¨ 64 ä¸ªå­—ç¬¦æ¥ä»£è¡¨çš„å­—ç¬¦ä¸²ï¼Œé¦–å…ˆå°†æ•°æ®åˆ†å‰²æˆ 8 ä½çš„äºŒè¿›åˆ¶å­—èŠ‚ï¼Œå†åˆ‡å‰²æˆ 6 ä½çš„æ•°æ®å—ï¼Œå†è½¬æ¢ä¸ºå…¶ä¸­çš„ 64 ä¸ªå­—ç¬¦ã€‚

ä½† base64 å½¢å¼çš„å­—ç¬¦ä¸²ä¸ä¸€å®šèƒ½è§£ç æˆå¸¸è§çš„æ•°æ®ï¼Œbase64 çš„ä¼˜åŠ¿æ˜¯å…¨éƒ¨æ˜¯ ASCII ç ä¸­çš„ 64 ä¸ªå­—ç¬¦ï¼Œåœ¨å„ç§å¹³å°è®¾å¤‡ä¸Šé€šç”¨ã€‚

å…¬ç§é’¥æœ‰ PEM æ ¼å¼å’Œ DER æ ¼å¼ä¸¤ç§æ ¼å¼ï¼ŒPEM æ ¼å¼æ˜¯æœ‰å¤´æœ‰å°¾ï¼ŒDER æ ¼å¼æ˜¯æ²¡æœ‰å¤´æ²¡æœ‰å°¾ã€‚

PEM æ ¼å¼çš„å…¬é’¥å’Œç§é’¥çš„å¤´å°¾åˆ†åˆ«æ˜¯ï¼š

```
-----BEGIN PUBLIC KEY-----
-----END PUBLIC KEY-----
```

```
-----BEGIN RSA PRIVATE KEY-----
-----END PRIVATE KEY-----
```

DER æ ¼å¼æ˜¯çº¯äºŒè¿›åˆ¶æ•°æ®è¡¨ç¤ºï¼Œæ—¢ PEM åœ¨å¤´å°¾ä¹‹é—´çš„ base64 æ•°æ®çš„äºŒè¿›åˆ¶å½¢å¼ã€‚ä¸¤è€…å¯ä»¥ç›¸äº’è½¬æ¢ã€‚

æ¯”å¦‚ base64 çš„ `MI...` æ•°æ®è½¬æ¢æˆåå…­è¿›åˆ¶åˆ™ä»£è¡¨ `30...`, å¯ä»¥ä½¿ç”¨åœ¨çº¿å·¥å…·è½¬æ¢ï¼š https://base64.guru/converter/decode/hex ã€‚

## æ•°å­¦çŸ¥è¯†

RSA çš„åŠ è§£å¯†ç®—æ³•æ˜¯ä¸€ç§éå¯¹ç§°å¯†ç ç®—æ³•ï¼ŒRSA ç®—æ³•åŸºäºä¸€ä¸ªéå¸¸é‡è¦çš„æ•°è®ºçŸ¥è¯†ï¼šå¤§æ•°çš„å› æ•°åˆ†è§£æ˜¯éå¸¸å›°éš¾çš„ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¿™æ ·çš„ä¸¤ä¸ªå¤§è´¨æ•°ï¼Œå°±å¯ä»¥ä¿è¯é€šä¿¡çš„å®‰å…¨ã€‚è¿™å°±æ˜¯ RSA ç®—æ³•çš„æ ¸å¿ƒå®‰å…¨åŸºç¡€ã€‚

#### 1. ç”Ÿæˆå¯†é’¥

- é€‰æ‹©ä¸¤ä¸ªä¸åŒçš„å¤§è´¨æ•° p å’Œ qï¼›
- è®¡ç®— `N=p*q`ã€‚Nçš„é•¿åº¦å°±æ˜¯å¯†é’¥é•¿åº¦ï¼›
- è®¡ç®—æ¬§æ‹‰å‡½æ•° `Ï†(N)=(p-1)*(q-1)`ï¼›
- é€‰æ‹©ä¸€ä¸ªæ•´æ•°eï¼Œä½¿å¾— `1<e<Ï†(N)`ï¼Œä¸” e ä¸ Ï†(N) äº’è´¨ã€‚è¿™ä¸ª e å°±æ˜¯å…¬é’¥çš„ä¸€éƒ¨åˆ†ï¼›
- è®¡ç®— dï¼Œä½¿å¾— `e*d mod Ï†(N) = 1`ã€‚då°±æ˜¯ç§é’¥ï¼›
- æœ€ç»ˆå…¬é’¥å°±æ˜¯ (e, N)ï¼Œç§é’¥å°±æ˜¯ (d, N)ã€‚

#### 2. åŠ å¯†è¿‡ç¨‹

å‡è®¾æœ‰ä¸€æ¡æ¶ˆæ¯ Mï¼ˆ0 <= M < Nï¼‰ï¼Œåˆ™å¯†æ–‡ C å¯ä»¥è¿™æ ·è®¡ç®—ï¼š`C = M^e mod N`ã€‚

#### 3. è§£å¯†è¿‡ç¨‹

ä½¿ç”¨ç§é’¥ (d, N) å¯¹å¯†æ–‡ C è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°æ˜æ–‡Mï¼š`M = C^d mod N`ã€‚


è¿™ä¸ªç®—æ³•çš„æ­£ç¡®æ€§åŸºäºæ¬§æ‹‰å®šç†ï¼ˆä¹Ÿæ˜¯è´¹é©¬å°å®šç†çš„ä¸€èˆ¬å½¢å¼ï¼‰ï¼šå¦‚æœä¸¤ä¸ªæ•°äº’è´¨ï¼Œé‚£ä¹ˆä¹˜æ•°çš„æ¬§æ‹‰å‡½æ•°æ¬¡æ–¹å†å¯¹è¢«ä¹˜æ•°å–æ¨¡çš„ç»“æœç­‰äº 1ã€‚

## ç”Ÿæˆ RSA å…¬é’¥

#### 1. ç”Ÿæˆ PEM ç§é’¥

```bash
$ openssl genpkey -algorithm RSA -out private_key.pem
```

#### 2. æ ¹æ®ç§é’¥ç”Ÿæˆå…¬é’¥

```bash
$ openssl rsa -pubout -in private_key.pem -out public_key.pem
```

#### 3. ä» PEM æ ¼å¼çš„ç§é’¥ç”Ÿæˆ DER æ ¼å¼çš„ç§é’¥

```bash
$ openssl rsa -in private_key.pem -outform DER -out private_key.der
```


####  4. ä» PEM æ ¼å¼çš„å…¬é’¥ç”Ÿæˆ DER æ ¼å¼çš„å…¬é’¥

```bash
$ openssl rsa -pubin -in public_key.pem -outform DER -out public_key.der
```

è¿™æ ·ä¼šæœ‰ 4 ä¸ªæ–‡ä»¶ï¼Œä¸¤ä¸ªç§é’¥ + ä¸¤ä¸ªå…¬é’¥ï¼Œå…¬ç§é’¥éƒ½æœ‰ä¸¤ä»½ï¼ŒPEM æ ¼å¼å’Œ DER æ ¼å¼ã€‚

å…¬é’¥å¦‚ä¸‹ï¼š

```
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxQsGcWyJ6EucBfFcAaGk
1sL8zUf0z7cy/+mwDUao97ctJiKUdViVFTx42ZMvw2MKh7XC3cyu/PbCBLQ7y2NQ
t5aRIFI/LW0wFsoUateSsUKaDRBys7DnyBrVCUFr8pN71bmHWjbYfW9iG72vqHKb
iUHpixQNyNGv7HCYAEpjOHdj+vMSHC2vISH2+ui53he8IFqiolOlD6JCaSZECkB0
Q+IYEtYRMBLcT8OiPOvQfBJijwMCbkxgocFNq4nby30tG4NyLyXBtMihn/6lDksP
KL7dLwFOF1bj/9hveAugSTE5xDE001/69oFwmx3CmDHwGqoLqmUTwwnvFwRSf3Ku
8QIDAQAB
-----END PUBLIC KEY-----
```

## è§£æ

ä½¿ç”¨ https://base64.guru/converter/decode/hex åœ¨çº¿è½¬æ¢å·¥å…·å°†å…¬é’¥è½¬æ¢ä½åå…­è¿›åˆ¶ï¼š

```
30820122300d06092a864886f70d01010105000382010f003082010a0282010100c50b06716c89e84b9c05f15c01a1a4d6c2fccd47f4cfb732ffe9b00d46a8f7b72d262294755895153c78d9932fc3630a87b5c2ddccaefcf6c204b43bcb6350b7969120523f2d6d3016ca146ad792b1429a0d1072b3b0e7c81ad509416bf2937bd5b9875a36d87d6f621bbdafa8729b8941e98b140dc8d1afec7098004a63387763faf3121c2daf2121f6fae8b9de17bc205aa2a253a50fa2426926440a407443e21812d6113012dc4fc3a23cebd07c12628f03026e4c60a1c14dab89dbcb7d2d1b83722f25c1b4c8a19ffea50e4b0f28bedd2f014e1756e3ffd86f780ba0493139c43134d35ffaf681709b1dc29831f01aaa0baa6513c309ef1704527f72aef10203010001
```

ä½¿ç”¨ https://hexed.it/ è¿™ä¸ªå·¥å…·æ‰“å¼€ DER æ ¼å¼çš„å…¬é’¥å¯ä»¥å¯¹æ¯”ï¼Œå‘ç°æ˜¯ä¸€æ ·çš„æ•°æ®ã€‚

æŒ‰ç…§ä¸‹é¢è¿™æ ·çš„è§£æè§„èŒƒï¼Œå¯ä»¥ä»è¿™é‡Œé¢æå–å‡ºæ¨¡æ•°å’ŒæŒ‡æ•°ï¼š

```
30|82010(a|0)        # Sequence of length 0x010(a|0)
    02|82010(1|0)    # Integer  of length 0x010(1|0)
        (00)?<modulus>
    02|03            # Integer  of length 0x03
        <exponent>
```

- é¦–å…ˆå¼€å¤´ 30 æ˜¯ä»£è¡¨ä¸‹ ASN.1 DER ç¼–ç çš„å¼€å§‹ï¼ŒSEQUENCE çš„æ ‡è¯†ç¬¦
- 820122 ç”¨æ¥æè¿°åºåˆ—çš„é•¿åº¦ï¼Œ82 å‰ç¼€ç”¨æ¥ä»£è¡¨æ¥ä¸‹æ¥ 2 ä¸ªå­—èŠ‚æ˜¯è¡¨è¾¾é•¿åº¦ï¼Œå…¶é•¿åº¦ä¸º **0122**ï¼Œä¹Ÿå°±æ˜¯é•¿åº¦æ˜¯ 290 ä¸ªå­—èŠ‚ï¼Œæ˜¯æ’é™¤æ‰å‰é¢ `30820122` çš„é•¿åº¦
- è·³è¿‡ä¸­é—´çš„ä¸€äº›é¢å¤–ä¿¡æ¯ï¼Œç›´æ¥åˆ° `02820101`ï¼Œè¿™é‡Œ 02 ä»£è¡¨ DER ç¼–ç çš„ INTEGER æ ‡è¯†ç¬¦ï¼Œ820101 ç”¨æ¥æè¿° INTEGER çš„é•¿åº¦ï¼Œå…¶é•¿åº¦ä¸º **0101**ï¼Œä¹Ÿå°±æ˜¯ RSA å…¬é’¥é•¿åº¦æ˜¯ 257 ä¸ªå­—èŠ‚
- 00 ä»£è¡¨æ¨¡æ•°çš„å¼€å§‹ï¼Œæ·»åŠ  00 æ˜¯ä¸ºäº†é˜²æ­¢è¿™ä¸ª INTEGER è¢«è¯¯è§£ä¸ºè´Ÿæ•°ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ¨¡æ•°çš„å…·ä½“å€¼
- æœ«å°¾çš„ 0203ï¼Œå…¶ä¸­ 02 æ˜¯ INTEGER æ ‡è¯†ç¬¦ï¼Œ03 æ˜¯è¿™ä¸ª INTEGER çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯ RSA å…¬é’¥çš„æŒ‡æ•°é•¿åº¦ï¼Œé•¿åº¦ä¸º 3 å­—èŠ‚
- æœ€å 10001 æ˜¯æŒ‡æ•°ï¼Œåå…­è¿›åˆ¶è½¬æ¢ä¸ºåè¿›åˆ¶æ˜¯ 65537

æ‰€ä»¥æå–åçš„æ¨¡æ•°æ˜¯ï¼š

```
c50b06716c89e84b9c05f15c01a1a4d6c2fccd47f4cfb732ffe9b00d46a8f7b72d262294755895153c78d9932fc3630a87b5c2ddccaefcf6c204b43bcb6350b7969120523f2d6d3016ca146ad792b1429a0d1072b3b0e7c81ad509416bf2937bd5b9875a36d87d6f621bbdafa8729b8941e98b140dc8d1afec7098004a63387763faf3121c2daf2121f6fae8b9de17bc205aa2a253a50fa2426926440a407443e21812d6113012dc4fc3a23cebd07c12628f03026e4c60a1c14dab89dbcb7d2d1b83722f25c1b4c8a19ffea50e4b0f28bedd2f014e1756e3ffd86f780ba0493139c43134d35ffaf681709b1dc29831f01aaa0baa6513c309ef1704527f72aef1
```

æŒ‡æ•°æ˜¯ï¼š65537 ã€‚

ä¸­é—´æœ‰è·³è¿‡å»ä¸€æ®µï¼š`300d06092a864886f70d01010105000382010f003082010a` æ˜¯ PEM æ ¼å¼å…¬é’¥ä¸­åŒ…å«çš„ä¸€äº›å…¶ä»–çš„å…ƒç´ ï¼Œä¾‹å¦‚ç‰ˆæœ¬å·å’Œä¸€äº›å¯é€‰çš„å‚æ•°ã€‚

å¦å¤–ï¼Œåœ¨ ASN.1 DER ç¼–ç ä¸­ï¼Œä¸€ä¸ªå€¼çš„é•¿åº¦å¯ä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚è¡¨ç¤ºã€‚è¿™æ˜¯ç”±é•¿åº¦å­—èŠ‚çš„æœ€é«˜ä½ï¼ˆæœ€å·¦è¾¹çš„ä½ï¼‰å†³å®šçš„ã€‚å¦‚æœæœ€é«˜ä½æ˜¯ 0ï¼Œé‚£ä¹ˆé•¿åº¦å°±ç”±è¿™ä¸€ä¸ªå­—èŠ‚ç›´æ¥è¡¨ç¤ºï¼›å¦‚æœæœ€é«˜ä½æ˜¯ 1ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ä½å°±è¡¨ç¤ºæ¥ä¸‹æ¥æœ‰å¤šå°‘ä¸ªå­—èŠ‚ç”¨äºè¡¨ç¤ºé•¿åº¦ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœé•¿åº¦å­—èŠ‚æ˜¯ 82ï¼Œé‚£ä¹ˆåœ¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ï¼Œå®ƒæ˜¯ 10000010ã€‚æœ€é«˜ä½æ˜¯ 1ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„ä½ï¼ˆ0000010ï¼Œä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„ 2ï¼‰è¡¨ç¤ºç”¨äºè¡¨ç¤ºé•¿åº¦çš„å­—èŠ‚çš„æ•°é‡ã€‚æ‰€ä»¥ï¼Œ82 è¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ 2 ä¸ªå­—èŠ‚ç”¨äºè¡¨ç¤ºé•¿åº¦ã€‚

å¦‚æœé•¿åº¦å­—èŠ‚æ˜¯ 81ï¼Œé‚£ä¹ˆè¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ 1 ä¸ªå­—èŠ‚ç”¨äºè¡¨ç¤ºé•¿åº¦ã€‚å¦‚æœé•¿åº¦å­—èŠ‚æ˜¯ 83ï¼Œé‚£ä¹ˆè¡¨ç¤ºæ¥ä¸‹æ¥æœ‰ 3 ä¸ªå­—èŠ‚ç”¨äºè¡¨ç¤ºé•¿åº¦ï¼Œä¾æ­¤ç±»æ¨ã€‚

[è¿™ä¸ªé¡¹ç›®é‡Œ](https://github.com/TakeScoop/SwiftyRSA/blob/master/Source/Asn1Parser.swift#L152)å¯ä»¥çœ‹åˆ°å®ƒæ˜¯æ€ä¹ˆè§£æçš„ï¼š

```
func parseNode(scanner: Scanner) throws -> Node {
		let firstByte = try scanner.consume(length: 1).firstByte
		
		// Sequence
		if firstByte == 0x30 {
				let length = try scanner.consumeLength()
				let data = try scanner.consume(length: length)
				let nodes = try parseSequence(data: data)
				return .sequence(nodes: nodes)
		}
		
		// Integer
		if firstByte == 0x02 {
				let length = try scanner.consumeLength()
				let data = try scanner.consume(length: length)
				return .integer(data: data)
		}
		
		// Object identifier
		if firstByte == 0x06 {
				let length = try scanner.consumeLength()
				let data = try scanner.consume(length: length)
				return .objectIdentifier(data: data)
		}
		
		// Null
		if firstByte == 0x05 {
				_ = try scanner.consume(length: 1)
				return .null
		}
		
		// Bit String
		if firstByte == 0x03 {
				let length = try scanner.consumeLength()
				
				// There's an extra byte (0x00) after the bit string length in all the keys I've encountered.
				// I couldn't find a specification that referenced this extra byte, but let's consume it and discard it.
				_ = try scanner.consume(length: 1)
				
				let data = try scanner.consume(length: length - 1)
				return .bitString(data: data)
		}
		
		// Octet String
		if firstByte == 0x04 {
				let length = try scanner.consumeLength()
				let data = try scanner.consume(length: length)
				return .octetString(data: data)
		}
		
		throw ParserError.invalidType(value: firstByte)
}
```

## RSA å…¬é’¥è§£å¯†

ä¸‹é¢æ˜¯ä¸€æ®µ go è¯­è¨€å†™çš„ä½¿ç”¨å…¬é’¥è¿›è¡Œ rsa è§£å¯†å‡½æ•°:

```go
func rsaDecrypt(input []byte) []byte {
	output := make([]byte, 0)
	cipherSize, blockSize := len(input), rsaServerKey.Size()
	for offset := 0; offset < cipherSize; offset += blockSize {
		sliceSize := blockSize
		if offset+sliceSize > cipherSize {
			sliceSize = cipherSize - offset
		}

		n := big.NewInt(0).SetBytes(input[offset : offset+sliceSize])
		m := big.NewInt(0).Exp(n, big.NewInt(int64(rsaServerKey.E)), rsaServerKey.N)
		b := m.Bytes()
		index := bytes.IndexByte(b, '\x00')
		if index < 0 {
			return nil
		}
		output = append(output, b[index+1:]...)
	}
	return output
}
```

é¦–å…ˆè®¡ç®—è¾“å…¥çš„æ•°æ®å¤§å°ï¼Œä»¥åŠå…¬é’¥çš„å¤§å°ã€‚å¦‚æœæ•°æ®å¤§äºå…¬é’¥å¤§å°éœ€è¦è¿›è¡Œåˆ†æ®µå¤„ç†ï¼Œæœ€åæ‹¼æ¥ã€‚å°†æ•°æ®æ ¹æ® rsa å¤§å°åˆ†å‰²æˆæ¯ä¸€å—æ¥å¤„ç†ã€‚
å°†æ¯ä¸€å—çš„è¾“å…¥å¡«å……åˆ°å˜é‡ n ä¸­ï¼Œn æ˜¯ä¸€ä¸ªå¤§æ•´æ•°ã€‚ç„¶åé€šè¿‡å…¬é’¥çš„æ¨¡æ•°ï¼ŒæŒ‡æ•°å’Œè¿™ä¸ª n è¿›è¡Œè®¡ç®—å¾—å‡ºç»“æœ mã€‚
å°† m è½¬æˆå­—èŠ‚åï¼ŒæŸ¥æ‰¾æ˜¯å¦æœ‰ `\x00`, ä¸ºä»€ä¹ˆè¦æŸ¥æ‰¾å‘¢ï¼Ÿå› ä¸º PKCS#1 v1.5 è§„å®šäº†æ•°æ®çš„å¡«å……ï¼Œè§£ç ä¸€ä¸ªä½¿ç”¨ PKCS#1 v1.5 å¡«å……çš„æ¶ˆæ¯æ—¶ï¼Œä½ å¯ä»¥ä»å·¦åˆ°å³æ‰«æå¡«å……æ¶ˆæ¯ï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ª '00' å­—èŠ‚ï¼Œè¿™å°±æ˜¯åˆ†éš”ç¬¦ã€‚åœ¨éå¯¹ç§°åŠ å¯†æ¯”å¦‚ RSA ä¸­ï¼Œå¦‚æœä¸è¿›è¡Œå¡«å……è€Œç›´æ¥è¿›è¡ŒåŠ å¯†æ˜¯ä¸å®‰å…¨çš„åšæ³•ï¼Œä¸å¡«å……ç›¸åŒçš„æ˜æ–‡å°†ä¼šäº§ç”Ÿç›¸åŒçš„å¯†æ–‡ï¼Œè¿™å¯èƒ½ä¼šæš´éœ²ç»™æ”»å‡»è€…ä¸€äº›ä¿¡æ¯ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡ PKCS#1 v1.5åœ¨å®è·µä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œä½†å®ƒå·²è¢«è¯æ˜å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œä¾‹å¦‚è‘—åçš„ Bleichenbacher's æ”»å‡»ã€‚å› æ­¤ï¼Œç°åœ¨æ›´æ¨èä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#1 v2.1ï¼Œä¹Ÿå°±æ˜¯ OAEPï¼ˆOptimal Asymmetric Encryption Paddingï¼‰å¡«å……æ–¹æ¡ˆã€‚

ç„¶åæ‰¾åˆ°å¡«å……ç‚¹ï¼Œå†å°†åé¢çš„æ•°æ®å–å‡ºå¹¶åˆå¹¶èµ·æ¥ï¼Œè¿™æ ·å°±å®Œæˆäº†è§£å¯†è¿‡ç¨‹ã€‚


## åè¯è§£é‡Š

- XDRï¼šXDRæ˜¯ä¸€ç§æ ‡å‡†æ•°æ®ä¸²è¡ŒåŒ–æ ¼å¼ï¼Œè¢«ç”¨äºæè¿°æ•°æ®åœ¨ä¸åŒä¸»æœºé—´çš„ä¼ è¾“æ ¼å¼ã€‚å®ƒè¢«è®¾è®¡å‡ºæ¥ä»¥è§£å†³å› æœºå™¨ã€æ“ä½œç³»ç»Ÿã€å’Œç½‘ç»œä¼ è¾“æ‰€å¼•å‘çš„æ•°æ®è¡¨ç¤ºä¸€è‡´æ€§é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ç”¨æ¥è§£å†³å¤§ç«¯å’Œå°ç«¯çš„é—®é¢˜ï¼Œæˆ–è€…æ•´æ•°å’Œæµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹å¼ç­‰é—®é¢˜ã€‚XDRå¸¸è§äºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰ç­‰ç½‘ç»œé€šä¿¡åœºæ™¯ã€‚
- DERï¼šDERæ˜¯ä¸€ç§äºŒè¿›åˆ¶ç¼–ç è§„åˆ™ï¼Œç”¨äºASN.1è§„å®šçš„æ•°æ®ç»“æ„ã€‚DERç¡®ä¿æ¯ä¸ªæ•°æ®é¡¹åªæœ‰ä¸€ç§ç¼–ç æ–¹å¼ï¼Œä½¿å¾—ç¼–ç åçš„æ•°æ®å¯ä»¥é€šè¿‡ç®€å•çš„å­—èŠ‚æ¯”è¾ƒè¿›è¡Œä¸€è‡´æ€§æ£€æŸ¥ã€‚DERå¸¸ç”¨äºå…¬é’¥åŸºç¡€è®¾æ–½å’ŒX.509è¯ä¹¦ã€‚
- ASN.1ï¼šASN.1æ˜¯ä¸€ç§è¯­æ³•ï¼Œç”¨äºæè¿°æ•°æ®ç»“æ„ã€‚å®ƒå¹¿æ³›åº”ç”¨äºç”µä¿¡å’Œè®¡ç®—æœºç½‘ç»œä¸­ï¼Œç”¨äºå®ç°ç½‘ç»œåè®®ã€é€šä¿¡åè®®å’ŒåŠ å¯†ç®—æ³•ç­‰ã€‚ASN.1æ•°æ®ç»“æ„å¯ä»¥ä½¿ç”¨å¤šç§ç¼–ç è§„åˆ™è¿›è¡Œç¼–ç ï¼Œå¦‚BERã€DERã€PERç­‰ã€‚
- X.509ï¼šX.509æ˜¯å…¬é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œå®šä¹‰äº†è¯ä¹¦çš„æ ¼å¼ã€‚è¯ä¹¦åŒ…å«å…¬é’¥ã€èº«ä»½ä¿¡æ¯å’Œä¸€äº›å…¶ä»–ä¿¡æ¯ã€‚X.509è¯ä¹¦é€šå¸¸ä½¿ç”¨DERç¼–ç ï¼Œå¹¶å¯èƒ½è¿›ä¸€æ­¥ä»¥PEMæˆ–å…¶ä»–æ ¼å¼è¿›è¡Œç¼–ç ã€‚
- PEMï¼šPEMæ˜¯ä¸€ç§ç”¨äºå°†äºŒè¿›åˆ¶æ•°æ®ç¼–ç ä¸ºASCIIå­—ç¬¦ä¸²çš„æ ¼å¼ã€‚PEMæ ¼å¼çš„æ–‡ä»¶é€šå¸¸åŒ…å«"-----BEGIN CERTIFICATE-----"å’Œ"-----END CERTIFICATE-----"ç­‰è¡Œã€‚è™½ç„¶PEMæœ€åˆæ˜¯ä¸ºç”µå­é‚®ä»¶è®¾è®¡çš„ï¼Œä½†ç°åœ¨å®ƒè¢«å¹¿æ³›åº”ç”¨äºSSLå’ŒTLSè¯ä¹¦ï¼ŒSSHå¯†é’¥ç­‰ã€‚

å½“ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªX.509è¯ä¹¦æ—¶ï¼Œä½ å¯èƒ½é¦–å…ˆä½¿ç”¨ASN.1æ¥å®šä¹‰æ•°æ®ç»“æ„ï¼Œç„¶åä½¿ç”¨DERå¯¹å…¶è¿›è¡Œç¼–ç ï¼Œæœ€åå°†ç¼–ç åçš„ç»“æœè½¬æ¢ä¸ºPEMæ ¼å¼ä»¥æ–¹ä¾¿å­˜å‚¨å’Œä¼ è¾“ã€‚

å½“ä½ ä»ä¸€ä¸ªHTTPSç½‘ç«™è·å–å®ƒçš„SSLè¯ä¹¦æ—¶ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ä¸€ä¸ªPEMæ ¼å¼çš„X.509è¯ä¹¦ã€‚è¿™ä¸ªè¯ä¹¦ä¸­åŒ…å«äº†ç”¨DERç¼–ç çš„ASN.1æ•°æ®ç»“æ„ã€‚

ASN.1é€šå¸¸ç”¨äºå®šä¹‰æ›´å¤æ‚çš„æ•°æ®ç»“æ„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªX.509è¯ä¹¦çš„ä¸»é¢˜åå¯èƒ½ä¼šç”¨ASN.1å®šä¹‰å¦‚ä¸‹ï¼š

```
Name ::= CHOICE { -- only one possibility for now --
    rdnSequence  RDNSequence }

RDNSequence ::= SEQUENCE OF RelativeDistinguishedName

RelativeDistinguishedName ::= SET SIZE (1..MAX) OF AttributeTypeAndValue
```

åœ¨ä¸Šé¢çš„ASN.1å®šä¹‰ä¸­ï¼ŒNameæ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªRelativeDistinguishedNameç»„æˆçš„åºåˆ—ï¼Œæ¯ä¸ªRelativeDistinguishedNameæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªAttributeTypeAndValueçš„é›†åˆã€‚åœ¨ç¼–ç ä¸ºDERæ ¼å¼æ—¶ï¼Œè¿™äº›æ•°æ®ç»“æ„ä¼šè¢«è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼ã€‚

PEMé€šå¸¸ç”¨äºè¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚X.509è¯ä¹¦ã€‚ä¸€ä¸ªX.509è¯ä¹¦å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·:

```
-----BEGIN CERTIFICATE-----
MIIDITCCAoqgAwIBAgIQL9+89q6RUm0PmqPfQDQ+mjANBgkqhkiG9w0BAQUFADBM
MQswCQYDVQQGEwJaQTElMCMGA1UEChMcVGhhd3RlIENvbnN1bHRpbmcgKFB0eSkg
THRkLjEWMBQGA1UEAxMNVGhhd3RlIFNHQyBDQTAeFw0wOTEyMTgwMDAwMDBaFw0x
...
-----END CERTIFICATE-----
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒPEMæ ¼å¼çš„æ•°æ®è¢«åŒ…å«åœ¨"BEGIN CERTIFICATE"å’Œ"END CERTIFICATE"æ ‡è®°ä¹‹é—´ã€‚è¿™äº›æ•°æ®å®é™…ä¸Šæ˜¯ç”¨Base64ç¼–ç çš„DERç¼–ç çš„X.509è¯ä¹¦ã€‚


## å‚è€ƒ

- [RFC 8017](https://datatracker.ietf.org/doc/html/rfc8017)
- [A Layman's Guide to a Subset of ASN.1, BER, and DER](http://luca.ntop.org/Teaching/Appunti/asn1.html)
- [Let's Encrypt: ASN.1 and DER Explained](http://luca.ntop.org/Teaching/Appunti/asn1.html)
- [å¾®è½¯: ASN.1 - Introduction](https://letsencrypt.org/docs/a-warm-welcome-to-asn1-and-der/)
